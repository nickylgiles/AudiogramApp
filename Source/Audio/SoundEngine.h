/*
  ==============================================================================

    SoundEngine.h
    Created: 28 Oct 2025 11:07:04pm
    Author:  nicky_hgjk9m6

  ==============================================================================
*/

#pragma once


#include "Spatial/HRTFManager.h"
#include "SoundSources/SoundSource.h"
#include "SoundSources/ToneSource.h"
#include "SoundSources/NoiseSource.h"
#include "SoundSources/SoundFileSource.h"
#include "SoundSources/SpatialisedSoundFileSource.h"
#include "SoundSources/SpatialisedNoiseSource.h"


class SoundEngine {
public:
    SoundEngine();
    void playTone(float frequency, float amplitude, float duration, int channel);
    void playToneMasked(float frequency, float amplitude, float duration, int channel);

    void playSample(const void* data, size_t size, float gain);
    void playSampleSpatial(const void* data, size_t size, float elevation, float azimuth, float gain);
    void playNoiseSpatial(float amplitude, float duration, float elevation, float azimuth);

    void stop();
    bool isPlaying() const;
    void setSampleRate(double newSampleRate);

    void processBlock(float* outputL, float* outputR, int numSamples);

private:
    void addSource(std::unique_ptr<SoundSource> source);

    double sampleRate;

    std::vector<std::unique_ptr<SoundSource>> sources;
    juce::SpinLock sourceLock;

    HRTFManager hrtfManager;
};

